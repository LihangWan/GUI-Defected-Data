# çº¢æ ‡ç»Ÿä¸€æ›´æ–°

## ğŸ“ æ›´æ–°å†…å®¹

ç°åœ¨ **action** å’Œ **end** ä¸¤å¼ å›¾ç‰‡çš„å³ä¸Šè§’éƒ½ä¼šæ˜¾ç¤ºç›¸åŒæ ·å¼çš„çº¢æ ‡ã€‚

### ä¿®æ”¹å‰ vs ä¿®æ”¹å

| å›¾ç‰‡ç±»å‹ | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|---------|--------|--------|
| **start** | æ— æ ‡è®° | æ— æ ‡è®° âœ“ |
| **action** | PIL ç»˜åˆ¶çš„çº¢æ ‡ âœ“ | PIL ç»˜åˆ¶çš„çº¢æ ‡ âœ“ |
| **end** | JS åŠ¨æ€è¦†ç›–å±‚ âŒ | PIL ç»˜åˆ¶çš„çº¢æ ‡ âœ“ |

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. ä¿®æ”¹ `visualize_action()` å‡½æ•°
**æ–‡ä»¶**: [interaction_engine/capture.py](interaction_engine/capture.py)

```python
# æ–°å¢æ¡ä»¶ï¼šåªåœ¨åæ ‡æœ‰æ•ˆæ—¶ç»˜åˆ¶æŒ‡é’ˆ
if x > 0 and y > 0:
    # ç»˜åˆ¶ç™½è‰²æŒ‡é’ˆ
    pointer = [...]
    draw.polygon(pointer, ...)

# çº¢æ ‡å§‹ç»ˆç»˜åˆ¶ï¼ˆä¸ä¾èµ–åæ ‡ï¼‰
if label:
    # ç»˜åˆ¶çº¢è‰²æ ‡ç­¾
    draw.rectangle([...], fill=(239, 68, 68, 240))
```

### 2. ä¿®æ”¹ `execute_injection()` å‡½æ•°
**æ–‡ä»¶**: [interaction_engine/injectors.py](interaction_engine/injectors.py)

```python
# End screenshot
try:
    # å…ˆä¿å­˜ä¸´æ—¶æˆªå›¾
    t1_temp_path = t1_path.replace("_end.png", "_end_temp.png")
    self.driver.save_screenshot(t1_temp_path)
    
    # ä½¿ç”¨ visualize_action æ·»åŠ çº¢æ ‡ï¼ˆåæ ‡ä¼ 0,0ä¸ç»˜åˆ¶æŒ‡é’ˆï¼‰
    safe_bug_label = bug_type if bug_type != "Unknown" else ...
    visualize_action(t1_temp_path, 0, 0, output_path=t1_path, label=safe_bug_label)
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    os.remove(t1_temp_path)
except Exception as e:
    print(f"  [Screenshot] Failed to save end screenshot: {e}")
    t1_path = None
```

### 3. ç§»é™¤ JS è¦†ç›–å±‚
åŸæ¥åœ¨ `finally` å—ä¸­ä½¿ç”¨ `show_overlay()` å‡½æ•°æ³¨å…¥ JS è¦†ç›–å±‚ï¼Œç°åœ¨å·²ç§»é™¤ï¼Œç»Ÿä¸€ä½¿ç”¨ PIL ç»˜åˆ¶ã€‚

## ğŸ“Š ä¸‰å¼ å›¾ç‰‡çš„æ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   START.png     â”‚   ACTION.png    â”‚    END.png      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚ [Timeout_Hang]â—„â”€â”¤ [Timeout_Hang]â—„â”€â”¤ å³ä¸Šè§’çº¢æ ‡
â”‚                 â”‚        â–¼        â”‚                 â”‚
â”‚  æ— æ ‡è®°         â”‚      æŒ‡é’ˆ       â”‚   æ— æŒ‡é’ˆ        â”‚
â”‚                 â”‚        â–¼        â”‚                 â”‚
â”‚                 â”‚    ç‚¹å‡»ä½ç½®     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… ä¼˜åŠ¿

1. **ä¸€è‡´æ€§**: action å’Œ end ä½¿ç”¨ç›¸åŒçš„çº¢æ ‡æ ·å¼
2. **å¯é æ€§**: ä¸ä¾èµ– JS æ³¨å…¥ï¼Œé¿å…é¡µé¢åˆ·æ–°åè¦†ç›–å±‚æ¶ˆå¤±
3. **æ¸…æ™°åº¦**: é™æ€ç»˜åˆ¶çš„çº¢æ ‡æ›´æ¸…æ™°ï¼Œä¸å—é¡µé¢å…ƒç´ é®æŒ¡
4. **å¯æ§æ€§**: é¢œè‰²ã€å°ºå¯¸ã€ä½ç½®å®Œå…¨ä¸€è‡´

## ğŸš€ ç«‹å³æµ‹è¯•

```bash
# ç”Ÿæˆæ–°æ ·æœ¬
python quick_sample_generator.py

# æ£€æŸ¥æ•ˆæœ
python check_samples.py

# æŸ¥çœ‹å›¾ç‰‡
# action å›¾ç‰‡: æœ‰çº¢æ ‡ + æœ‰æŒ‡é’ˆ
# end å›¾ç‰‡: æœ‰çº¢æ ‡ + æ— æŒ‡é’ˆ
```

## ğŸ“¸ é¢„æœŸæ•ˆæœ

### action å›¾ç‰‡
- âœ… å³ä¸Šè§’çº¢æ ‡: `[Timeout_Hang]`
- âœ… ç™½è‰²æŒ‡é’ˆæŒ‡å‘ç‚¹å‡»ä½ç½®

### end å›¾ç‰‡  
- âœ… å³ä¸Šè§’çº¢æ ‡: `[Timeout_Hang]`ï¼ˆå’Œ action ç›¸åŒï¼‰
- âŒ æ— æŒ‡é’ˆï¼ˆå› ä¸ºå·²ç»ç‚¹å‡»å®Œæˆï¼‰

å®Œç¾ï¼ç°åœ¨ä¸‰å¼ å›¾ç‰‡å½¢æˆå®Œæ•´çš„æ•…äº‹ï¼š
1. **start**: åˆå§‹çŠ¶æ€
2. **action**: å³å°†ç‚¹å‡»ï¼ˆæœ‰æŒ‡é’ˆ + çº¢æ ‡ï¼‰
3. **end**: ç‚¹å‡»åçŠ¶æ€ï¼ˆåªæœ‰çº¢æ ‡ï¼Œè¡¨ç¤ºbugä»å­˜åœ¨ï¼‰

---

ğŸ‰ ä¿®æ”¹å®Œæˆï¼ä¸¤å¼ å›¾ç‰‡çš„çº¢æ ‡ç°åœ¨å®Œå…¨ä¸€è‡´äº†ã€‚
